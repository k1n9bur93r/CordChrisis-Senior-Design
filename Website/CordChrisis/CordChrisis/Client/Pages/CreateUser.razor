@page "/signUp"
@using CordChrisis.Shared
@using CordChrisis.Shared.Models
@using System.Security;
@inject HttpClient Http
@inject NavigationManager NavigationManager
@inject IJSRuntime js
@inject Blazored.SessionStorage.ISessionStorageService Storage

<div class=" container rounded mt-4 p-1 bg-light">
    <div class="jumbotron">
        <form name="createUser" onsubmit="return false">
            <div class="container">
                <h1>Sign Up</h1>
                <p>Please fill in this form to create an account.</p>
                <hr>


                <ul>
                    <li>
                        <label for="email"><b>Email</b></label>
                        <input type="text" placeholder="Enter Email" name="email" @bind="email" required>
                    </li>

                    <li>
                        <label for="password"><b>Password</b></label>
                        <input type="password" placeholder="Enter Password" name="password" @bind="password" required>

                    </li>



                    <li>

                        <label for="pswrepeat"><b>Repeat Password</b></label>
                        <input type="password" placeholder="Repeat Password" name="pswrepeat" @bind="pswrepeat" required>

                    </li>

                </ul>
                @if (check == false)
                {
                    @if (bademail == true)
                    {
                        <p>@email</p>
                        <p>Email</p>

                    }
                    else if (badpassword == true)
                    {
                        <p>@password</p>
                        <p>password</p>
                    }
                    else if (badpsswordreapeat == true)
                    {
                        <p>@pswrepeat</p>
                        <p>pswordrepeat</p>
                    }
                    else if (noteq == true)
                    {
                        <p>@email</p>
                        <p>Passwords are not equal</p>
                    }
                    else
                    {

                        <p>One more fields were not filled out correctly</p>
                    }
                }
                <p>By creating an account you agree to our <a href="#" style="color:dodgerblue">Terms & Privacy</a>.</p>

                <div>
                    <button id="addUser" class="btn btn-primary" @onclick="addUser"> Sign Up</button>
                </div>

            </div>
        </form>

    </div>
</div>





@code {

    User newUser { get; set; }
    string email { get; set; }
    string password { get; set; }
    string pswrepeat { get; set; }
    Login checkData = new Login();
    bool check = true;
    bool noteq = false;
    bool bademail = false;
    bool badpassword = false;
    bool badpsswordreapeat = false;


    protected async override void OnInitialized()
    {
       Task<bool> checkGameRunning = Storage.GetItemAsync<bool>("GameRunning");
        bool isRunning = await checkGameRunning;

        if (isRunning)
        {
            await this.js.InvokeVoidAsync("quit");
            await Storage.SetItemAsync("GameRunning",false);
            base.OnInitialized();
        }
        Console.WriteLine(isRunning);
        base.OnInitialized();


    }

    public async Task<bool> addUser()
    {


        if (email == null || email == String.Empty)
        {
            bademail = true;
            check = false;
            return check;
        }

        if (password == null || password == String.Empty)
        {
            badpassword = true;
            check = false;
            return check;
        }


        if (pswrepeat == null || pswrepeat == String.Empty)
        {
            badpsswordreapeat = true;
            check = false;
            return check;
        }

        if (password != pswrepeat)
        {
            noteq = true;
            check = false;
            return check;
        }

        Login loginObject = new Login
        {
            Email = email,
            Password = password
        };

        checkData = await Http.PostJsonAsync<Login>("createaccount/post", loginObject);
        if (checkData.Email == "test")
        {
            NavigationManager.NavigateTo("/");
            return false; 
        }
        else
        {
            check = false;
            return false;
        }
    }



}

